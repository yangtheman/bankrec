<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self'; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>BankRec - Bank Reconciliation</title>
    <link rel="icon" type="image/png" href="../../assets/app_logo.png">
    <link href="../styles/styles.css" rel="stylesheet" type="text/css" />
</head>
<body class="bg-base-200">
    <!-- Onboarding Screen -->
    <div id="onboarding-screen" class="screen active">
        <div class="container max-w-2xl mx-auto p-8">
            <div class="card bg-base-100 shadow-2xl">
                <div class="card-body">
                    <h1 class="card-title text-4xl font-bold mb-6 text-center">Welcome to BankRec</h1>
                    <form id="onboarding-form" class="space-y-4">
                        <div class="form-control">
                            <label class="label" for="firstName">
                                <span class="label-text font-semibold">First Name *</span>
                            </label>
                            <input type="text" id="firstName" required class="input input-bordered w-full">
                        </div>
                        <div class="form-control">
                            <label class="label" for="lastName">
                                <span class="label-text font-semibold">Last Name *</span>
                            </label>
                            <input type="text" id="lastName" required class="input input-bordered w-full">
                        </div>
                        <div class="form-control">
                            <label class="label" for="email">
                                <span class="label-text font-semibold">Email *</span>
                            </label>
                            <input type="email" id="email" required class="input input-bordered w-full">
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-semibold">Database Location</span>
                            </label>
                            <div class="flex gap-2">
                                <input type="text" id="db-path-input" readonly class="input input-bordered flex-1 bg-base-200" placeholder="Default location will be used">
                                <button type="button" id="choose-db-path-btn" class="btn btn-neutral">Choose Location</button>
                            </div>
                            <label class="label">
                                <span class="label-text-alt">Leave empty to use the default location in your app data folder</span>
                            </label>
                        </div>
                        <button type="submit" class="btn btn-primary w-full">Continue</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Encryption Key Screen -->
    <div id="encryption-key-screen" class="screen">
        <div class="container max-w-3xl mx-auto p-8">
            <div class="card bg-base-100 shadow-2xl">
                <div class="card-body">
                    <h1 class="card-title text-4xl font-bold mb-6 text-center">Your Encryption Key</h1>
                    
                    <div class="alert alert-warning mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <div>
                            <h3 class="font-bold text-lg">⚠️ IMPORTANT - READ CAREFULLY</h3>
                            <div class="text-sm mt-2">
                                <p class="font-semibold mb-2">This encryption key protects all your financial data. You MUST save it securely!</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Write it down and store it in a safe place</li>
                                    <li>Save it to a password manager</li>
                                    <li>You will need this key to export and import your database</li>
                                    <li>Without this key, your exported data cannot be recovered</li>
                                    <li>We cannot recover this key for you if you lose it</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="bg-base-200 p-6 rounded-lg mb-6">
                        <label class="label">
                            <span class="label-text font-bold text-lg">Your Encryption Key:</span>
                        </label>
                        <div class="relative">
                            <input type="text" id="encryption-key-display" readonly 
                                   class="input input-bordered w-full font-mono text-sm bg-white" 
                                   value="Generating key...">
                            <button id="copy-key-btn" class="btn btn-sm btn-ghost absolute right-2 top-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                                Copy
                            </button>
                        </div>
                        <label class="label">
                            <span class="label-text-alt text-xs">This key is also stored securely on your device</span>
                        </label>
                    </div>

                    <div class="form-control mb-4">
                        <label class="label cursor-pointer justify-start gap-3">
                            <input type="checkbox" id="key-saved-checkbox" class="checkbox checkbox-primary" required>
                            <span class="label-text font-semibold">I have saved my encryption key in a safe place</span>
                        </label>
                    </div>

                    <button id="continue-to-app-btn" class="btn btn-primary w-full" disabled>
                        Continue to Application
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="main-screen" class="screen">
        <header class="navbar bg-base-100 shadow-lg px-4">
            <div class="flex-1 flex items-center gap-3">
                <img src="../../assets/app_logo.png" alt="BankRec Logo" class="h-10 w-10">
                <h1 class="text-3xl font-bold">BankRec</h1>
            </div>
            <div class="flex-none">
                <div class="flex gap-2">
                    <!-- Theme Toggle Button -->
                    <button id="theme-toggle-btn" class="btn btn-ghost btn-circle" title="Toggle theme">
                        <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                    <button id="settings-btn" class="btn btn-ghost btn-circle" title="Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                    <button id="add-transaction-btn" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        Add Transaction
                    </button>
                    <button id="import-csv-btn" class="btn btn-neutral">Import CSV</button>
                    <button id="import-btn" class="btn btn-neutral">Import DB</button>
                    <button id="export-btn" class="btn btn-neutral">Export DB</button>
                </div>
            </div>
        </header>

        <div class="main-content p-6 max-w-7xl mx-auto">
            <!-- Balance Summary -->
            <div class="card bg-primary text-primary-content shadow-xl mb-6">
                <div class="card-body">
                    <h2 class="card-title text-2xl">Current Balance</h2>
                    <div class="text-5xl font-bold" id="current-balance">$0.00</div>
                </div>
            </div>



            <!-- Reconciliation Section -->
            <div class="alert alert-warning shadow-lg mb-6" id="reconciliation-section" style="display: none;">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                    <div>
                        <h3 class="font-bold">Reconciliation Needed</h3>
                        <div class="text-sm">You have <span id="unreconciled-count">0</span> unreconciled transaction(s).</div>
                    </div>
                </div>
                <button id="start-reconciliation-btn" class="btn btn-sm btn-primary">Start Reconciliation</button>
            </div>

            <!-- Transactions List -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-3xl mb-4">Transactions</h2>
                    <div class="flex flex-col lg:flex-row gap-4 mb-4">
                        <div class="flex-1">
                            <input type="text" id="search-box" placeholder="Search transactions..." class="input input-bordered w-full">
                        </div>
                        <div class="flex flex-wrap gap-2 items-center">
                            <div class="flex items-center gap-2">
                                <label class="label-text font-semibold">From:</label>
                                <input type="date" id="start-date" class="input input-bordered input-sm">
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="label-text font-semibold">To:</label>
                                <input type="date" id="end-date" class="input input-bordered input-sm">
                            </div>
                            <button id="clear-filters-btn" class="btn btn-ghost btn-sm">Clear</button>
                        </div>
                    </div>
                    <div class="text-sm text-base-content/70 mb-2">
                        <span id="transaction-count">Showing 0 transactions</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table id="transactions-table" class="table table-zebra w-full">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Check #</th>
                                    <th>Payee</th>
                                    <th>Category</th>
                                    <th>Debit</th>
                                    <th>Credit</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-body">
                                <tr>
                                    <td colspan="9" class="text-center py-8 text-base-content/60">No transactions yet. Add your first transaction above.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex justify-center items-center gap-4 mt-4">
                        <button id="prev-page-btn" class="btn btn-secondary" disabled>Previous</button>
                        <span id="page-info" class="font-semibold">Page 1 of 1</span>
                        <button id="next-page-btn" class="btn btn-secondary" disabled>Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reconciliation Modal -->
    <div id="reconciliation-modal" class="modal">
        <div class="modal-box max-w-3xl">
            <h2 class="font-bold text-2xl mb-4">Reconcile Transactions</h2>
            <div class="form-control mb-4">
                <label class="label cursor-pointer justify-start gap-2">
                    <input type="checkbox" id="reconcile-all-checkbox" class="checkbox checkbox-primary">
                    <span class="label-text font-bold">Reconcile All</span>
                </label>
            </div>
            <div id="reconciliation-list" class="mb-4"></div>
            <div class="modal-action">
                <button id="save-reconciliation-btn" class="btn btn-primary">Save</button>
                <button id="cancel-reconciliation-btn" class="btn btn-ghost">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-box">
            <h2 class="font-bold text-2xl mb-4">Add Custom Category</h2>
            <div class="form-control mb-4">
                <label class="label" for="new-category-type">
                    <span class="label-text font-semibold">Category Type *</span>
                </label>
                <select id="new-category-type" required class="select select-bordered w-full">
                    <option value="income">Income</option>
                    <option value="expense">Expense</option>
                </select>
            </div>
            <div class="form-control mb-4">
                <label class="label" for="new-category-name">
                    <span class="label-text font-semibold">Category Name *</span>
                </label>
                <input type="text" id="new-category-name" placeholder="Enter category name" required class="input input-bordered w-full">
            </div>
            <div class="modal-action">
                <button id="save-category-btn" class="btn btn-primary">Add Category</button>
                <button id="cancel-category-btn" class="btn btn-ghost">Cancel</button>
            </div>
        </div>
    </div>

    <!-- CSV Import Modal -->
    <div id="csv-import-modal" class="modal">
        <div class="modal-box max-w-5xl max-h-[90vh]">
            <h2 class="font-bold text-2xl mb-4">Import CSV - Review & Reconcile Transactions</h2>
            <p id="csv-summary" class="mb-4 text-base-content/70"></p>
            <div class="form-control mb-4">
                <label class="label cursor-pointer justify-start gap-2">
                    <input type="checkbox" id="csv-select-all" checked class="checkbox checkbox-primary">
                    <span class="label-text font-semibold">Select All</span>
                </label>
            </div>
            <div id="csv-preview-body" class="space-y-4 overflow-y-auto max-h-[60vh]">
                <!-- CSV transaction cards will be inserted here -->
            </div>
            <div class="modal-action">
                <button id="import-csv-confirm-btn" class="btn btn-primary">Import Selected Transactions</button>
                <button id="cancel-csv-import-btn" class="btn btn-ghost">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Transaction Modal -->
    <div id="add-transaction-modal" class="modal">
        <div class="modal-box max-w-2xl">
            <h2 id="transaction-modal-title" class="font-bold text-2xl mb-4">Add Transaction</h2>
            <form id="transaction-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label" for="txDate">
                            <span class="label-text font-semibold">Date *</span>
                        </label>
                        <input type="date" id="txDate" required class="input input-bordered w-full">
                    </div>
                    <div class="form-control">
                        <label class="label" for="checkNumber">
                            <span class="label-text font-semibold">Check Number</span>
                        </label>
                        <input type="text" id="checkNumber" placeholder="Optional" class="input input-bordered w-full">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label" for="payee">
                            <span class="label-text font-semibold">Payee *</span>
                        </label>
                        <input type="text" id="payee" required class="input input-bordered w-full" list="payee-list" autocomplete="off">
                        <datalist id="payee-list"></datalist>
                    </div>
                    <div class="form-control">
                        <label class="label" for="txType">
                            <span class="label-text font-semibold">Type *</span>
                        </label>
                        <select id="txType" required class="select select-bordered w-full">
                            <option value="debit">Payment (Debit)</option>
                            <option value="credit">Deposit (Credit)</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label" for="category">
                            <span class="label-text font-semibold">Category *</span>
                        </label>
                        <select id="category" required class="select select-bordered w-full">
                            <option value="">-- Select Category --</option>
                        </select>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">&nbsp;</span>
                        </label>
                        <button type="button" id="add-category-btn" class="btn btn-neutral w-full">+ Add Custom Category</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label" for="amount">
                            <span class="label-text font-semibold">Amount *</span>
                        </label>
                        <input type="number" id="amount" step="0.01" min="0" required class="input input-bordered w-full">
                    </div>
                    <div class="form-control flex flex-col justify-end">
                        <label class="label cursor-pointer justify-start gap-3 h-12 items-center">
                            <input type="checkbox" id="reconciled" class="checkbox checkbox-primary">
                            <span class="label-text font-semibold">Reconciled</span>
                        </label>
                    </div>
                </div>
                <div class="modal-action">
                    <button type="submit" class="btn btn-primary">Save Transaction</button>
                    <button type="button" id="save-and-add-another-btn" class="btn btn-success">Save and Add Another</button>
                    <button type="button" id="cancel-transaction-btn" class="btn btn-ghost">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Password Modal for Export -->
    <div id="export-password-modal" class="modal">
        <div class="modal-box">
            <h2 class="font-bold text-2xl mb-4">Set Export Password</h2>
            <p class="mb-4 text-base-content/70">Enter a password to encrypt your exported database file.</p>
            <form id="export-password-form" class="space-y-4">
                <div class="form-control">
                    <label class="label" for="exportPassword">
                        <span class="label-text font-semibold">Password *</span>
                    </label>
                    <input type="password" id="exportPassword" required minlength="8" class="input input-bordered w-full">
                    <label class="label">
                        <span class="label-text-alt">Minimum 8 characters. Remember this password - you'll need it to import this file.</span>
                    </label>
                </div>
                <div class="form-control">
                    <label class="label" for="exportPasswordConfirm">
                        <span class="label-text font-semibold">Confirm Password *</span>
                    </label>
                    <input type="password" id="exportPasswordConfirm" required minlength="8" class="input input-bordered w-full">
                </div>
                <div id="export-password-error" class="alert alert-error" style="display: none;"></div>
                <div class="modal-action">
                    <button type="submit" class="btn btn-primary">Export with Password</button>
                    <button type="button" id="cancel-export-btn" class="btn btn-ghost">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Password Modal for Import -->
    <div id="import-password-modal" class="modal">
        <div class="modal-box">
            <h2 class="font-bold text-2xl mb-4">Enter Import Password</h2>
            <p class="mb-4 text-base-content/70">Enter the password used to encrypt this database file.</p>
            <p class="mb-4 text-sm"><strong>File:</strong> <span id="import-file-path" class="break-all"></span></p>
            <form id="import-password-form" class="space-y-4">
                <div class="form-control">
                    <label class="label" for="importPassword">
                        <span class="label-text font-semibold">Password *</span>
                    </label>
                    <input type="password" id="importPassword" required class="input input-bordered w-full">
                </div>
                <div id="import-password-error" class="alert alert-error" style="display: none;"></div>
                <div class="modal-action">
                    <button type="submit" class="btn btn-primary">Import with Password</button>
                    <button type="button" id="cancel-import-btn" class="btn btn-ghost">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-box max-w-2xl">
            <h2 class="font-bold text-2xl mb-4">Settings</h2>
            
            <!-- Database Location Section -->
            <div class="mb-6">
                <h3 class="font-semibold text-lg mb-3">Database Location</h3>
                <div class="alert alert-info mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div class="text-sm">
                        <p>Changing the database location will copy your current database to the new location.</p>
                    </div>
                </div>
                <div class="form-control mb-4">
                    <label class="label">
                        <span class="label-text font-semibold">Current Database Path:</span>
                    </label>
                    <input type="text" id="current-db-path" readonly class="input input-bordered w-full bg-base-200 font-mono text-sm" value="Loading...">
                </div>
                <button id="change-db-path-btn" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                    </svg>
                    Change Database Location
                </button>
            </div>

            <div class="modal-action">
                <button id="close-settings-btn" class="btn btn-ghost">Close</button>
            </div>
        </div>
    </div>

    <script src="../renderer/app.js"></script>
</body>
</html>
